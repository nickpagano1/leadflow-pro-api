<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile & Settings - LeadFlow Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #000000;
            --secondary-color: #666666;
            --border-color: #e5e5e5;
            --bg-light: #fafafa;
            --bg-white: #ffffff;
            --text-primary: #000000;
            --text-secondary: #666666;
            --text-muted: #999999;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --error-color: #ef4444;
            --radius: 8px;
            --shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 4px 16px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: var(--text-primary);
            background: var(--bg-light);
        }

        /* Navigation */
        .navbar {
            background: var(--bg-white);
            border-bottom: 1px solid var(--border-color);
            padding: 0 24px;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 64px;
        }

        .logo {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-primary);
            text-decoration: none;
        }

        .nav-links {
            display: flex;
            gap: 32px;
            list-style: none;
        }

        .nav-links a {
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 400;
            font-size: 14px;
            transition: color 0.2s ease;
        }

        .nav-links a:hover,
        .nav-links a.active {
            color: var(--text-primary);
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .user-info {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .logout-btn {
            background: none;
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            padding: 8px 16px;
            border-radius: var(--radius);
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .logout-btn:hover {
            background: var(--bg-light);
            color: var(--text-primary);
        }

        /* Main Content */
        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 32px 24px;
        }

        .page-header {
            margin-bottom: 32px;
        }

        .page-title {
            font-size: 28px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .page-subtitle {
            font-size: 16px;
            color: var(--text-secondary);
        }

        /* Settings Navigation */
        .settings-container {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 32px;
        }

        .settings-nav {
            background: var(--bg-white);
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            padding: 24px 0;
            height: fit-content;
            position: sticky;
            top: 96px;
        }

        .settings-nav-item {
            display: block;
            padding: 12px 24px;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            border-left: 3px solid transparent;
            transition: all 0.2s ease;
        }

        .settings-nav-item:hover,
        .settings-nav-item.active {
            color: var(--text-primary);
            background: var(--bg-light);
            border-left-color: var(--text-primary);
        }

        .settings-nav-item.active {
            background: rgba(0, 0, 0, 0.05);
        }

        /* Settings Content */
        .settings-content {
            background: var(--bg-white);
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            min-height: 600px;
        }

        .settings-section {
            padding: 32px;
            border-bottom: 1px solid var(--border-color);
            display: none;
        }

        .settings-section.active {
            display: block;
        }

        .settings-section:last-child {
            border-bottom: none;
        }

        .section-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .section-description {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 24px;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 24px;
        }

        .form-group:last-child {
            margin-bottom: 0;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .form-input {
            width: 100%;
            max-width: 400px;
            padding: 12px 16px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            font-size: 14px;
            transition: border-color 0.2s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--text-primary);
        }

        .form-textarea {
            width: 100%;
            max-width: 600px;
            padding: 12px 16px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            font-size: 14px;
            min-height: 100px;
            resize: vertical;
            font-family: inherit;
        }

        .form-textarea:focus {
            outline: none;
            border-color: var(--text-primary);
        }

        .form-help {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 4px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        /* Avatar Upload */
        .avatar-section {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 24px;
        }

        .avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: var(--bg-light);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            font-weight: 600;
            color: var(--text-secondary);
            overflow: hidden;
        }

        .avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .avatar-upload {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .upload-btn {
            background: var(--text-primary);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: var(--radius);
            font-size: 14px;
            cursor: pointer;
            transition: opacity 0.2s ease;
        }

        .upload-btn:hover {
            opacity: 0.9;
        }

        .remove-btn {
            background: none;
            color: var(--error-color);
            border: none;
            font-size: 14px;
            cursor: pointer;
            text-decoration: underline;
        }

        /* Company Logo Upload */
        .logo-preview {
            max-width: 200px;
            max-height: 80px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            padding: 12px;
            margin-top: 12px;
            display: none;
        }

        .logo-preview img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 26px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: 0.4s;
            border-radius: 26px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: var(--text-primary);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(24px);
        }

        /* Buttons */
        .btn {
            padding: 12px 24px;
            border-radius: var(--radius);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
        }

        .btn-primary {
            background: var(--text-primary);
            color: white;
        }

        .btn-primary:hover {
            opacity: 0.9;
        }

        .btn-secondary {
            background: var(--bg-light);
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: var(--border-color);
        }

        .btn-danger {
            background: var(--error-color);
            color: white;
        }

        .btn-danger:hover {
            opacity: 0.9;
        }

        /* Success Message */
        .success-message {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success-color);
            padding: 12px 16px;
            border-radius: var(--radius);
            font-size: 14px;
            margin-bottom: 24px;
            display: none;
        }

        /* Billing Section */
        .billing-info {
            background: var(--bg-light);
            padding: 20px;
            border-radius: var(--radius);
            margin-bottom: 24px;
        }

        .plan-badge {
            display: inline-block;
            background: var(--text-primary);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            margin-bottom: 12px;
        }

        .billing-amount {
            font-size: 24px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .billing-period {
            font-size: 14px;
            color: var(--text-secondary);
        }

        /* Email Template Preview */
        .template-preview {
            background: var(--bg-light);
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            padding: 20px;
            margin-top: 16px;
            max-height: 400px;
            overflow-y: auto;
        }

        .template-preview h4 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--text-primary);
        }

        .template-content {
            font-family: Georgia, serif;
            line-height: 1.6;
            white-space: pre-wrap;
            font-size: 14px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .settings-container {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .settings-nav {
                position: static;
                display: flex;
                overflow-x: auto;
                padding: 0;
                border-radius: 0;
                border: none;
                border-bottom: 1px solid var(--border-color);
                background: none;
            }

            .settings-nav-item {
                white-space: nowrap;
                border-left: none;
                border-bottom: 3px solid transparent;
                padding: 16px 20px;
            }

            .settings-nav-item.active {
                border-bottom-color: var(--text-primary);
                border-left: none;
                background: none;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .main-container {
                padding: 20px 16px;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="/" class="logo">LeadFlow Pro</a>
            <ul class="nav-links">
                <li><a href="/dashboard">Dashboard</a></li>
                <li><a href="/properties">Properties</a></li>
                <li><a href="/inquiries">Inquiries</a></li>
                <li><a href="/automation">Automation</a></li>
                <li><a href="/analytics">Analytics</a></li>
            </ul>
            <div class="user-menu">
                <span class="user-info" id="userInfo">Loading...</span>
                <button class="logout-btn" onclick="logout()">Sign out</button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="main-container">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-title">Profile & Settings</h1>
            <p class="page-subtitle">Manage your account, preferences, and billing</p>
        </div>

        <!-- Settings Container -->
        <div class="settings-container">
            <!-- Settings Navigation -->
            <nav class="settings-nav">
                <a href="#profile" class="settings-nav-item active" onclick="showSection('profile')">👤 Profile</a>
                <a href="#company" class="settings-nav-item" onclick="showSection('company')">🏢 Company</a>
                <a href="#branding" class="settings-nav-item" onclick="showSection('branding')">🎨 Branding</a>
                <a href="#email" class="settings-nav-item" onclick="showSection('email')">📧 Email Settings</a>
                <a href="#acuity" class="settings-nav-item" onclick="showSection('acuity')">📅 Acuity Integration</a>
                <a href="#notifications" class="settings-nav-item" onclick="showSection('notifications')">🔔 Notifications</a>
                <a href="#billing" class="settings-nav-item" onclick="showSection('billing')">💳 Billing</a>
                <a href="#security" class="settings-nav-item" onclick="showSection('security')">🔒 Security</a>
                <a href="#danger" class="settings-nav-item" onclick="showSection('danger')">⚠️ Danger Zone</a>
            </nav>

            <!-- Settings Content -->
            <div class="settings-content">
                <!-- Profile Section -->
                <div id="profile-section" class="settings-section active">
                    <h2 class="section-title">Personal Information</h2>
                    <p class="section-description">Update your personal details and profile photo</p>

                    <div class="success-message" id="profile-success">Profile updated successfully!</div>

                    <!-- Avatar Upload -->
                    <div class="avatar-section">
                        <div class="avatar" id="avatar-preview">
                            NP
                        </div>
                        <div class="avatar-upload">
                            <input type="file" id="avatar-upload" accept="image/*" style="display: none;" onchange="handleAvatarUpload(event)">
                            <button class="upload-btn" onclick="document.getElementById('avatar-upload').click()">
                                Upload Photo
                            </button>
                            <button class="remove-btn" onclick="removeAvatar()">Remove</button>
                        </div>
                    </div>

                    <form id="profile-form" onsubmit="saveProfile(event)">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">First Name</label>
                                <input type="text" id="firstName" class="form-input" value="Nicholas" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Last Name</label>
                                <input type="text" id="lastName" class="form-input" value="Pagano" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Email Address</label>
                            <input type="email" id="email" class="form-input" value="npagano@besenpartners.com" required>
                            <div class="form-help">This email is used for login and notifications</div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Phone Number</label>
                                <input type="tel" id="phone" class="form-input" value="(718) 772-3227">
                            </div>
                            <div class="form-group">
                                <label class="form-label">License Number</label>
                                <input type="text" id="license" class="form-input" placeholder="Real estate license #">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Bio</label>
                            <textarea id="bio" class="form-textarea" placeholder="Tell clients about yourself..."></textarea>
                            <div class="form-help">This will appear in your email signature and property listings</div>
                        </div>

                        <button type="submit" class="btn btn-primary">Save Changes</button>
                    </form>
                </div>

                <!-- Company Section -->
                <div id="company-section" class="settings-section">
                    <h2 class="section-title">Company Information</h2>
                    <p class="section-description">Manage your company details and contact information</p>

                    <form id="company-form" onsubmit="saveCompany(event)">
                        <div class="form-group">
                            <label class="form-label">Company Name</label>
                            <input type="text" id="companyName" class="form-input" value="Besen Partners" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Company Address</label>
                            <textarea id="companyAddress" class="form-textarea" placeholder="Full company address..."></textarea>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Company Phone</label>
                                <input type="tel" id="companyPhone" class="form-input" placeholder="(555) 123-4567">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Company Website</label>
                                <input type="url" id="companyWebsite" class="form-input" placeholder="https://yourcompany.com">
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary">Save Changes</button>
                    </form>
                </div>

                <!-- Branding Section -->
                <div id="branding-section" class="settings-section">
                    <h2 class="section-title">Branding & Customization</h2>
                    <p class="section-description">Customize how your brand appears in emails and property listings</p>

                    <form id="branding-form" onsubmit="saveBranding(event)">
                        <div class="form-group">
                            <label class="form-label">Company Logo</label>
                            <input type="file" id="logo-upload" accept="image/*" style="display: none;" onchange="handleLogoUpload(event)">
                            <button type="button" class="upload-btn" onclick="document.getElementById('logo-upload').click()">
                                Upload Logo
                            </button>
                            <div class="form-help">Recommended: 300x100px, PNG or JPG format</div>
                            <div class="logo-preview" id="logo-preview">
                                <img id="logo-image" src="" alt="Company Logo">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Brand Color (Primary)</label>
                                <input type="color" id="brandColor" class="form-input" value="#000000">
                                <div class="form-help">Used for buttons and highlights</div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Brand Color (Secondary)</label>
                                <input type="color" id="brandColorSecondary" class="form-input" value="#666666">
                                <div class="form-help">Used for text and borders</div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Email Footer</label>
                            <textarea id="emailFooter" class="form-textarea" placeholder="Custom text that appears at the bottom of all automated emails..."></textarea>
                        </div>

                        <button type="submit" class="btn btn-primary">Save Changes</button>
                    </form>
                </div>

                <!-- Email Settings Section -->
                <div id="email-section" class="settings-section">
                    <h2 class="section-title">Email Automation Settings</h2>
                    <p class="section-description">Configure your automated email responses and templates</p>

                    <form id="email-form" onsubmit="saveEmailSettings(event)">
                        <div class="form-group">
                            <label class="form-label">Email Signature</label>
                            <textarea id="emailSignature" class="form-textarea" 
                                placeholder="Nicholas Pagano&#10;Licensed Real Estate Salesperson&#10;Besen Partners&#10;npagano@besenpartners.com&#10;(718) 772-3227"></textarea>
                            <div class="form-help">This appears at the end of all automated emails</div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                <input type="checkbox" id="autoRespond" checked> 
                                Enable Automatic Email Responses
                            </label>
                            <div class="form-help">Automatically send responses to new property inquiries</div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Response Delay (minutes)</label>
                            <input type="number" id="responseDelay" class="form-input" value="5" min="0" max="60">
                            <div class="form-help">How long to wait before sending automated response</div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Custom Email Template</label>
                            <textarea id="emailTemplate" class="form-textarea" style="min-height: 200px;"
                                placeholder="Thank you for your inquiry!&#10;&#10;Hi {prospect_name},&#10;&#10;Hope all is well and thank you for your interest in {property_address}!"></textarea>
                            <div class="form-help">Use {prospect_name}, {property_address}, {rent}, etc. for dynamic content</div>
                        </div>

                        <div class="template-preview">
                            <h4>Email Preview</h4>
                            <div class="template-content" id="template-preview-content">
                                <!-- Preview will be generated here -->
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary">Save Changes</button>
                    </form>
                </div>

                <!-- Acuity Integration Section -->
                <div id="acuity-section" class="settings-section">
                    <h2 class="section-title">Acuity Scheduling Integration</h2>
                    <p class="section-description">Connect your Acuity Scheduling account for automated tour bookings</p>

                    <form id="acuity-form" onsubmit="saveAcuitySettings(event)">
                        <div class="form-group">
                            <label class="form-label">Acuity User ID</label>
                            <input type="text" id="acuityUserId" class="form-input" placeholder="Your Acuity User ID">
                            <div class="form-help">Found in your Acuity Settings → Integrations → API</div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Acuity API Key</label>
                            <input type="password" id="acuityApiKey" class="form-input" placeholder="Your Acuity API Key">
                            <div class="form-help">Keep this secret - used to sync appointment bookings</div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Default Appointment Type ID</label>
                            <input type="text" id="defaultAppointmentType" class="form-input" placeholder="e.g., 12345">
                            <div class="form-help">Used when property doesn't have specific appointment type</div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                <input type="checkbox" id="acuityEnabled"> 
                                Enable Acuity Integration
                            </label>
                            <div class="form-help">Automatically include booking links in emails</div>
                        </div>

                        <button type="submit" class="btn btn-primary">Save Changes</button>
                        <button type="button" class="btn btn-secondary" onclick="testAcuityConnection()">Test Connection</button>
                    </form>
                </div>

                <!-- Notifications Section -->
                <div id="notifications-section" class="settings-section">
                    <h2 class="section-title">Notification Preferences</h2>
                    <p class="section-description">Choose what notifications you want to receive</p>

                    <form id="notifications-form" onsubmit="saveNotifications(event)">
                        <div class="form-group">
                            <label class="form-label">
                                <input type="checkbox" id="emailNewInquiry" checked> 
                                New Inquiry Notifications
                            </label>
                            <div class="form-help">Get notified when new property inquiries arrive</div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                <input type="checkbox" id="emailTourScheduled" checked> 
                                Tour Scheduled Notifications
                            </label>
                            <div class="form-help">Get notified when prospects schedule tours</div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                <input type="checkbox" id="emailWeeklyReport" checked> 
                                Weekly Activity Reports
                            </label>
                            <div class="form-help">Weekly summary of inquiries and automation performance</div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                <input type="checkbox" id="emailBilling"> 
                                Billing & Payment Notifications
                            </label>
                            <div class="form-help">Notifications about subscription payments and billing</div>
                        </div>

                        <button type="submit" class="btn btn-primary">Save Changes</button>
                    </form>
                </div>

                <!-- Billing Section -->
                <div id="billing-section" class="settings-section">
                    <h2 class="section-title">Billing & Subscription</h2>
                    <p class="section-description">Manage your subscription and payment methods</p>

                    <!-- Current Plan -->
                    <div class="billing-info">
                        <div class="plan-badge">Pro Plan</div>
                        <div class="billing-amount">$29.00</div>
                        <div class="billing-period">per month</div>
                        <p style="margin-top: 12px; font-size: 14px; color: var(--text-secondary);">
                            Next billing date: September 9, 2025
                        </p>
                    </div>

                    <!-- Payment Method -->
                    <div class="form-group">
                        <label class="form-label">Payment Method</label>
                        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                            <span style="font-size: 14px;">**** **** **** 4242</span>
                            <span style="font-size: 12px; color: var(--text-muted);">Expires 12/27</span>
                            <button type="button" class="btn btn-secondary" onclick="updatePaymentMethod()">Update</button>
                        </div>
                    </div>

                    <!-- Billing History -->
                    <div class="form-group">
                        <label class="form-label">Billing History</label>
                        <button type="button" class="btn btn-secondary" onclick="viewBillingHistory()">
                            View Invoices & Download Receipts
                        </button>
                    </div>

                    <!-- Plan Management -->
                    <div class="form-group">
                        <label class="form-label">Plan Management</label>
                        <div style="display: flex; gap: 12px;">
                            <button type="button" class="btn btn-secondary" onclick="upgradePlan()">Upgrade Plan</button>
                            <button type="button" class="btn btn-secondary" onclick="cancelSubscription()">Cancel Subscription</button>
                        </div>
                    </div>
                </div>

                <!-- Security Section -->
                <div id="security-section" class="settings-section">
                    <h2 class="section-title">Security Settings</h2>
                    <p class="section-description">Manage your password and account security</p>

                    <form id="password-form" onsubmit="changePassword(event)">
                        <div class="form-group">
                            <label class="form-label">Current Password</label>
                            <input type="password" id="currentPassword" class="form-input" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label">New Password</label>
                            <input type="password" id="newPassword" class="form-input" required>
                            <div class="form-help">Must be at least 8 characters with letters and numbers</div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Confirm New Password</label>
                            <input type="password" id="confirmPassword" class="form-input" required>
                        </div>

                        <button type="submit" class="btn btn-primary">Change Password</button>
                    </form>

                    <div style="margin-top: 32px; padding-top: 32px; border-top: 1px solid var(--border-color);">
                        <div class="form-group">
                            <label class="form-label">
                                <input type="checkbox" id="twoFactorAuth"> 
                                Enable Two-Factor Authentication
                            </label>
                            <div class="form-help">Add an extra layer of security to your account</div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Active Sessions</label>
                            <button type="button" class="btn btn-secondary" onclick="viewActiveSessions()">
                                View & Manage Active Sessions
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Danger Zone Section -->
                <div id="danger-section" class="settings-section">
                    <h2 class="section-title">Danger Zone</h2>
                    <p class="section-description">Irreversible actions that affect your account</p>

                    <div style="border: 1px solid var(--error-color); border-radius: var(--radius); padding: 24px;">
                        <div class="form-group">
                            <label class="form-label" style="color: var(--error-color);">Export Account Data</label>
                            <p style="font-size: 14px; color: var(--text-secondary); margin-bottom: 12px;">
                                Download all your properties, inquiries, and automation data
                            </p>
                            <button type="button" class="btn btn-secondary" onclick="exportAccountData()">
                                Export Data
                            </button>
                        </div>

                        <div class="form-group">
                            <label class="form-label" style="color: var(--error-color);">Delete Account</label>
                            <p style="font-size: 14px; color: var(--text-secondary); margin-bottom: 12px;">
                                Permanently delete your account and all associated data. This cannot be undone.
                            </p>
                            <button type="button" class="btn btn-danger" onclick="deleteAccount()">
                                Delete Account
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Check authentication
        function checkAuth() {
            const token = localStorage.getItem('access_token');
            if (!token) {
                window.location.href = '/login';
                return false;
            }
            return true;
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            if (!checkAuth()) return;
            loadUserInfo();
            updateEmailPreview();
        });

        // Load user information
        function loadUserInfo() {
            const agentName = localStorage.getItem('agent_name') || 'User';
            document.getElementById('userInfo').textContent = agentName;
        }

        // Show section
        function showSection(sectionName) {
            // Hide all sections
            const sections = document.querySelectorAll('.settings-section');
            sections.forEach(section => section.classList.remove('active'));

            // Remove active from all nav items
            const navItems = document.querySelectorAll('.settings-nav-item');
            navItems.forEach(item => item.classList.remove('active'));

            // Show selected section
            document.getElementById(sectionName + '-section').classList.add('active');

            // Add active to clicked nav item
            event.target.classList.add('active');
        }

        // Handle avatar upload
        function handleAvatarUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const avatar = document.getElementById('avatar-preview');
                    avatar.innerHTML = `<img src="${e.target.result}" alt="Avatar">`;
                };
                reader.readAsDataURL(file);
            }
        }

        // Remove avatar
        function removeAvatar() {
            const avatar = document.getElementById('avatar-preview');
            avatar.innerHTML = 'NP';
        }

        // Handle logo upload
        function handleLogoUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById('logo-preview');
                    const image = document.getElementById('logo-image');
                    image.src = e.target.result;
                    preview.style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        }

        // Update email preview
        function updateEmailPreview() {
            const template = document.getElementById('emailTemplate');
            if (template) {
                template.addEventListener('input', function() {
                    const preview = document.getElementById('template-preview-content');
                    let content = template.value || 'Thank you for your inquiry!\n\nHi {prospect_name},\n\nHope all is well and thank you for your interest in {property_address}!';
                    
                    // Replace placeholders with sample data
                    content = content
                        .replace('{prospect_name}', 'John Smith')
                        .replace('{property_address}', '49 Prince Street Apt 19')
                        .replace('{rent}', '$5,850')
                        .replace('{bedrooms}', '2')
                        .replace('{bathrooms}', '1');
                    
                    preview.textContent = content;
                });
            }
        }

        // Form submissions
        function saveProfile(event) {
            event.preventDefault();
            showSuccess('profile-success');
            // TODO: Implement API call to save profile
        }

        function saveCompany(event) {
            event.preventDefault();
            // TODO: Implement API call to save company
        }

        function saveBranding(event) {
            event.preventDefault();
            // TODO: Implement API call to save branding
        }

        function saveEmailSettings(event) {
            event.preventDefault();
            // TODO: Implement API call to save email settings
        }

        function saveAcuitySettings(event) {
            event.preventDefault();
            // TODO: Implement API call to save Acuity settings
        }

        function saveNotifications(event) {
            event.preventDefault();
            // TODO: Implement API call to save notifications
        }

        function changePassword(event) {
            event.preventDefault();
            // TODO: Implement API call to change password
        }

        // Utility functions
        function showSuccess(elementId) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            setTimeout(() => {
                element.style.display = 'none';
            }, 3000);
        }

        function testAcuityConnection() {
            alert('Testing Acuity connection... (feature coming soon)');
        }

        function updatePaymentMethod() {
            alert('Redirecting to Stripe payment method update... (feature coming soon)');
        }

        function viewBillingHistory() {
            alert('Opening billing history... (feature coming soon)');
        }

        function upgradePlan() {
            alert('Plan upgrade options... (feature coming soon)');
        }

        function cancelSubscription() {
            if (confirm('Are you sure you want to cancel your subscription?')) {
                alert('Subscription cancellation... (feature coming soon)');
            }
        }

        function viewActiveSessions() {
            alert('Active sessions management... (feature coming soon)');
        }

        function exportAccountData() {
            alert('Exporting account data... (feature coming soon)');
        }

        function deleteAccount() {
            const confirmation = prompt('Type "DELETE" to confirm account deletion:');
            if (confirmation === 'DELETE') {
                alert('Account deletion... (feature coming soon)');
            }
        }

        function logout() {
            localStorage.removeItem('access_token');
            localStorage.removeItem('agent_id');
            localStorage.removeItem('agent_name');
            localStorage.removeItem('email');
            window.location.href = '/login';
        }
    </script>
</body>
</html>